general:
  artifacts:
        - "~/target/*" # anything in target directory
machine:
  java:
    version: oraclejdk8
  services:
      - docker
dependencies:
  cache_directories:
      - "~/docker"
  pre:
      - sudo pip install awsebcli #install aws eb cli for deployment
  override:
      - mvn clean install
      - pwd
      - cd target
      - mv ../target/Scrayble-1.0.0.jar .
      - if [[ -e ~/docker/image.tar ]]; then docker load -i ~/docker/image.tar; fi
      - docker build -t vlanderson/timeinc-test . #load image from cache if possible
      - mkdir -p ~/docker; docker save vlanderson/timeinc-test > ~/docker/image.tar 
      - docker info
      - docker build -t vlanderson/timeinc-test . #build new image
      - docker push vlanderson/timeinc-test #deploy new image
test:
  override:
      - docker run -d -p 8080:8080 vlanderson/timeinc-test; sleep 10 #un container
      - curl --retry 10 --retry-delay 5 -v http://localhost:8080 #test service
deployment:
  production:
    branch: master
    commands:
      - bash ./setup-eb.sh
      - eb deploy
      